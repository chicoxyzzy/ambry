"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function createStorage(e){var t=e.type,r=void 0===t?"localStorage":t,n=e.namespace,a=void 0===n?null:n,s=e.schemeVersion,i=void 0===s?null:s,c=e.clearOnExceed,o=void 0===c?!0:c;return new Storage({type:r,schemeVersion:i,namespace:a,clearOnExceed:o})}var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();Object.defineProperty(exports,"__esModule",{value:!0});var FIREFOX_ERROR_NAME="NS_ERROR_DOM_QUOTA_REACHED",IE8_ERROR_MAGIC_NUMBER=-2147024882,SCHEME_VERSION_FIELD_NAME="__schemeVersion",Storage=function(){function e(t){var r=t.type,n=t.namespace,a=t.schemeVersion,s=t.clearOnExceed;_classCallCheck(this,e);var i=window[r];try{var c="test";i.setItem(c,c),i.removeItem(c)}catch(e){throw new Error("No storage of type "+r+" available in this environment.")}this._storage=i,this._prefix=n?n+".":"",this._clearOnExceed=s,this._schemeVersion=this.getItem(SCHEME_VERSION_FIELD_NAME),this.setSchemeVersion(a)}return _createClass(e,[{key:"setSchemeVersion",value:function(e){this._schemeVersion!==e&&(this.clear(),this.setItem(SCHEME_VERSION_FIELD_NAME,e))}},{key:"clear",value:function(){try{this._storage.clear()}catch(e){console.warn(e)}}},{key:"prefixName",value:function(e){return""+this._prefix+e}},{key:"getItem",value:function(e){try{return JSON.parse(this._storage.getItem(this.prefixName(e)))}catch(e){return console.warn(e),{}}}},{key:"removeItem",value:function(e){try{JSON.parse(this._storage.removeItem(this.prefixName(e)))}catch(e){console.warn(e)}}},{key:"setItem",value:function(e,t){try{return this._storage.setItem(this.prefixName(e),JSON.stringify(t)),t}catch(r){if(this.isQuotaExceeded(r)&&(console.warn("Quote is exceeded."),this._clearOnExceed))return console.warn("Clearing storage."),this.clear(),this._storage.setItem(this.prefixName(e),JSON.stringify(t)),t}}}],[{key:"isQuotaExceeded",value:function(e){if(e)if(e.code)switch(e.code){case 22:return!0;case 1014:return e.name===FIREFOX_ERROR_NAME;default:return!1}else if(e.number===IE8_ERROR_MAGIC_NUMBER)return!0;return!1}}]),e}();exports.default=createStorage;